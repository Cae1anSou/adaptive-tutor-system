<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元素选择颜色测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .test-area {
            border: 2px dashed #ccc;
            padding: 20px;
            margin: 20px 0;
            min-height: 300px;
        }
        
        .element-demo {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .current-chapter {
            background-color: rgba(0, 121, 211, 0.1);
            border-left: 4px solid #0079d3;
        }
        
        .previous-chapter {
            background-color: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-box {
            width: 20px;
            height: 20px;
            border: 2px solid;
            border-radius: 3px;
        }
        
        .blue-box {
            border-color: #0079d3;
            background-color: rgba(0, 121, 211, 0.1);
        }
        
        .red-box {
            border-color: #dc3545;
            background-color: rgba(220, 53, 69, 0.1);
        }
        
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #1e7e34;
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: black;
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-entry.success { color: #28a745; }
        .log-entry.error { color: #dc3545; }
        .log-entry.info { color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>元素选择颜色测试</h1>
            <p>测试元素选择时的颜色区分功能</p>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="color-box blue-box"></div>
                <span>蓝色 - 当前章节元素</span>
            </div>
            <div class="legend-item">
                <div class="color-box red-box"></div>
                <span>红色 - 之前章节元素</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" onclick="startSelector()">开始选择</button>
            <button class="btn btn-success" onclick="stopSelector()">停止选择</button>
            <button class="btn btn-warning" onclick="clearLog()">清空日志</button>
        </div>
        
        <div id="status-container"></div>
        
        <div class="test-area">
            <h3>测试区域</h3>
            <p>在这个区域中移动鼠标，观察不同元素的颜色变化</p>
            
            <div class="element-demo current-chapter">
                <h4>当前章节元素 (蓝色)</h4>
                <p>这些元素属于当前学习的章节，选择时会显示蓝色高亮。</p>
                <div>
                    <span>span标签</span>
                    <strong>strong标签</strong>
                    <em>em标签</em>
                </div>
            </div>
            
            <div class="element-demo previous-chapter">
                <h4>之前章节元素 (红色)</h4>
                <p>这些元素属于之前学习的章节，选择时会显示红色高亮。</p>
                <div>
                    <h1>h1标题</h1>
                    <h2>h2标题</h2>
                    <p>p段落</p>
                </div>
            </div>
            
            <div class="element-demo">
                <h4>其他元素</h4>
                <p>这些元素不属于学习范围，不会显示高亮。</p>
                <div>
                    <button>按钮</button>
                    <input type="text" placeholder="输入框" />
                    <select><option>下拉框</option></select>
                </div>
            </div>
        </div>
        
        <div class="log-container">
            <h3>测试日志</h3>
            <div id="log-content"></div>
        </div>
    </div>

    <script>
        // 模拟选择模块
        let selector = null;
        let isActive = false;
        
        // 模拟当前章节和之前章节的元素
        const currentElements = ['span', 'strong', 'em'];
        const previousElements = ['h1', 'h2', 'p'];
        const allElements = [...currentElements, ...previousElements];
        
        // 模拟高亮元素
        let highlightEl = null;
        
        function createHighlightElement() {
            if (highlightEl) return;
            
            highlightEl = document.createElement('div');
            highlightEl.className = 'sw-highlight';
            Object.assign(highlightEl.style, {
                position: 'fixed',
                display: 'none',
                pointerEvents: 'none',
                border: '2px solid #0079d3',
                backgroundColor: 'rgba(0, 121, 211, 0.1)',
                zIndex: '2147483646'
            });
            document.body.appendChild(highlightEl);
        }
        
        function removeHighlightElement() {
            if (highlightEl) {
                document.body.removeChild(highlightEl);
                highlightEl = null;
            }
        }
        
        function updateHighlight(element) {
            if (!highlightEl || !element) return;
            
            const rect = element.getBoundingClientRect();
            const tagName = element.tagName.toLowerCase();
            
            // 判断元素类型并设置相应的颜色
            let borderColor, backgroundColor;
            
            // 检查是否是当前章节的元素
            const isCurrentElement = currentElements.includes(tagName);
            // 检查是否是之前章节的元素
            const isPreviousElement = previousElements.includes(tagName);
            
            if (isCurrentElement) {
                // 当前章节元素 - 蓝色
                borderColor = '#0079d3';
                backgroundColor = 'rgba(0, 121, 211, 0.1)';
                log(`高亮当前章节元素: ${tagName} (蓝色)`, 'info');
            } else if (isPreviousElement) {
                // 之前章节元素 - 红色
                borderColor = '#dc3545';
                backgroundColor = 'rgba(220, 53, 69, 0.1)';
                log(`高亮之前章节元素: ${tagName} (红色)`, 'info');
            } else {
                // 不在学习范围内的元素
                log(`元素不在学习范围内: ${tagName}`, 'error');
                return;
            }
            
            Object.assign(highlightEl.style, {
                display: 'block',
                left: `${rect.left}px`,
                top: `${rect.top}px`,
                width: `${rect.width}px`,
                height: `${rect.height}px`,
                border: `2px solid ${borderColor}`,
                backgroundColor: backgroundColor
            });
        }
        
        function hideHighlight() {
            if (highlightEl) {
                highlightEl.style.display = 'none';
            }
        }
        
        function getElementAtPoint(x, y) {
            const elementsStack = document.elementsFromPoint(x, y);
            return elementsStack.find((element) => 
                !element.closest('.sw-highlight') && 
                !element.closest('.sw-selector') &&
                element !== document.body
            );
        }
        
        function shouldIgnoreElement(element) {
            if (!element) return true;
            
            // 检查是否在允许的元素列表中
            const tag = element.tagName.toLowerCase();
            return !allElements.includes(tag);
        }
        
        function handleMouseMove(event) {
            if (!isActive) return;
            
            requestAnimationFrame(() => {
                hideHighlight();
                
                const element = getElementAtPoint(event.clientX, event.clientY);
                if (!element || shouldIgnoreElement(element)) {
                    return;
                }
                
                updateHighlight(element);
            });
        }
        
        function handleMouseClick(event) {
            if (!isActive) return;
            
            const element = getElementAtPoint(event.clientX, event.clientY);
            if (!element || shouldIgnoreElement(element)) {
                return;
            }
            
            const tagName = element.tagName.toLowerCase();
            const isCurrent = currentElements.includes(tagName);
            const isPrevious = previousElements.includes(tagName);
            
            if (isCurrent) {
                log(`选中当前章节元素: ${tagName}`, 'success');
            } else if (isPrevious) {
                log(`选中之前章节元素: ${tagName}`, 'success');
            }
        }
        
        function startSelector() {
            if (isActive) return;
            
            isActive = true;
            createHighlightElement();
            
            // 添加事件监听器
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('click', handleMouseClick);
            
            showStatus('选择器已启动，移动鼠标查看颜色变化', 'info');
            log('选择器启动', 'info');
        }
        
        function stopSelector() {
            if (!isActive) return;
            
            isActive = false;
            removeHighlightElement();
            
            // 移除事件监听器
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('click', handleMouseClick);
            
            showStatus('选择器已停止', 'success');
            log('选择器停止', 'info');
        }
        
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        function showStatus(message, type = 'info') {
            const statusContainer = document.getElementById('status-container');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusContainer.appendChild(statusDiv);
            
            setTimeout(() => {
                statusDiv.remove();
            }, 3000);
        }
        
        function clearLog() {
            const logContent = document.getElementById('log-content');
            logContent.innerHTML = '';
            log('日志已清空', 'info');
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('页面加载完成，可以开始测试', 'info');
            log(`当前章节元素: ${currentElements.join(', ')}`, 'info');
            log(`之前章节元素: ${previousElements.join(', ')}`, 'info');
        });
    </script>
</body>
</html>
